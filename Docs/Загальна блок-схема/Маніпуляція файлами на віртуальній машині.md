<mark style="background: #FFF3A3A6;">ToDo:</mark>
- [x] <mark style="background: #BBFABBA6;">Створити сервіс для маніпуляцію директоріями та файлами на віртуальній машині за допомогою SFTP протоколу ✅ 2024-04-03</mark>
- [ ] Написати метод для створення директорії
- [ ] Написати метод для видалення директорії
- [ ] Написати метод для отримання файлу із машини
- [ ] Написати метод для завантаження файлу в машину
- [ ] Створити контролер для сервісу
- [ ] Написати команди для бота

## Створити сервіс для маніпуляцію директоріями та файлами на віртуальній машині за допомогою SFTP протоколу
<mark style="background: #ADCCFFA6;">SFTP (SSH File Transfer Protocol)</mark> — протокол прикладного рівня, призначений для копіювання та виконання інших операцій з файлами поверх надійного і безпечного з'єднання. Протокол розроблений групою IETF як розширення до SSH-2, однак SFTP допускає реалізацію та з використанням інших протоколів сеансового рівня.

Бібліотека Renci.SshNet на ряду із клієнтом для створення SSH підключення також надає клієнт для створення SFTP клієнта. Саме цей функціонал бібліотеки буде використаний для досягнення поставленої цілі. 

Для опису та визначення всіх методів, що будуть притаманні сервісу, який буде взаємодіяти із файловою системою машини був розроблений інтерфейс ISFTPRequestService:
```CSharp
public interface ISFTPRequestService
{

}
```

Також було створено клас SFTPRequestService, який реалізує цей інтерфейс:
```CSharp
public class SFTPRequestService : ISFTPRequestService
{
    private Dictionary<string, SftpClient> _clients = new Dictionary<string, SftpClient>();
    
    public CancellationTokenSource CancellationTokenSource = new CancellationTokenSource();

    private SftpClient GetClient (VirtualMachine virtualMachine, string userId)
    {
        if (_clients.TryGetValue(userId, out SftpClient? client))
        {
            return client;
        }
        else
        {
            var method = new PasswordAuthenticationMethod(virtualMachine.UserName, virtualMachine.Password);
            var connection = new ConnectionInfo(virtualMachine.Host, virtualMachine.Port, virtualMachine.UserName, method);
            client = new SftpClient(connection);
            _clients.Add(userId, client);

            return client;
        }
    }
}
```

В даному класі є приватний метод, який дозволяє отримати особистий SFTP-клієнт, якщо він створений або створити новий, якщо ні
## Написати метод для створення директорії
Опис метод у інтерфейсі має наступний вигляд:
```CSharp
Task<string> CreateDirectoryAsync(SFTPRequestDto dto);
```

Його реалізація виглядає наступним чином:
```CSharp
public async Task<string> CreateDirectoryAsync(SFTPRequestDto dto)
{
    var client = GetClient(dto.VirtualMachine!, dto.UserId!);

    try
    {
        await client.ConnectAsync(CancellationTokenSource.Token);
        client.CreateDirectory(dto.Data);

        return $"Directory successfully created\nTo go in it write command \"cd ${dto.Data}\"";
    }
    catch (Exception e)
    {
        return $"Some error has occurred during creating:\n{e.Message}";
    }
    finally
    {
        client.Disconnect();
    }
}
```

Спочатку сервіс отримує/створює клієнт, який буде виконувати SFTP запити. Далі він намагається підключити клієнт до віртуальної машини та створити директорію. Якщо все проходить успішно, то користувачу повертається повідомлення із тим, що все пройшло успішно, якщо ж створити директорію не вдалося, то користувачу виводиться повідомлення про це. Не залежно від успішності виконання команди вкінці метод від'єднує клієнта від машини