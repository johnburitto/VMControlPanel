<mark style="background: #FFB86CA6;">ToDo:</mark>
- [x] <mark style="background: #BBFABBA6;">–ù–∞–ø–∏—Å–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É –≤–∏—Ö–æ–¥—É —ñ–∑ —Å–∏—Å—Ç–µ–º–∏ ‚úÖ 2024-04-15</mark>
- [x] <mark style="background: #BBFABBA6;">–û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∑–∞–∫–µ—à–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ ‚úÖ 2024-04-15</mark>
- [x] <mark style="background: #BBFABBA6;">–û—á–∏—Å—Ç–∏—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∏ —Ç–∞ –ø–æ—Ç–æ–∫–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏—Å—è –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏—Ö –º–∞—à–∏–Ω ‚úÖ 2024-04-15</mark>

## –ù–∞–ø–∏—Å–∞—Ç–∏ –∫–æ–º–∞–Ω–¥—É –≤–∏—Ö–æ–¥—É —ñ–∑ —Å–∏—Å—Ç–µ–º–∏
```CSharp
public class ExitCommand : MessageCommand
{
    public override List<string>? Names { get; set; } = [ "üö™ –í–∏–π—Ç–∏ —ñ–∑ –∞–∫–∞—É–Ω—Ç–∞", "/exit" ];

    public override async Task ExecuteAsync(ITelegramBotClient client, Message? message)
    {
        await client.SendTextMessageAsync(message!.Chat.Id, "–í–∏ –≤–∏–π—à–ª–∏ —ñ–∑ —Å–∏—Å—Ç–µ–º–∏", parseMode: ParseMode.Html, replyMarkup: Keyboards.StartKeyboard);
    }
}
```
## –û—á–∏—Å—Ç–∏—Ç–∏ –≤—Å—ñ –∑–∞–∫–µ—à–æ–≤–∞–Ω—ñ –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
```CSharp
await StateMachine.RemoveStateAsync(message!.Chat.Id);
await RequestClient.DeleteCachedAsync($"{message.Chat.Id}_vm");
await RequestClient.DeleteCachedAsync($"{message.Chat.Id}_current_user_id");
await RequestClient.DeleteCachedAsync($"{message.Chat.Id}_auth");
```

–û—Å–∫—ñ–ª—å–∫–∏ –±—ñ–ª—å—à—ñ—Å—Ç—å –¥–∞–Ω–∏—Ö –∑–∞–∫–µ—à–æ–≤–∞–Ω—ñ –≤ Redis, —Ç–æ –¥–æ—Å—Ç–∞—Ç–Ω—å–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ http-–∑–∞–ø–∏—Ç –Ω–∞ –µ–Ω–¥–ø–æ—ó–Ω—Ç, —è–∫–∏–π –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –∑–∞ –≤–∏–¥–∞–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö —ñ–∑ Redis. –î–ª—è —Ü—å–æ–≥–æ –≤ –∫–ª–∞—Å RequestClient –±—É–ª–æ –¥–æ–¥–∞–Ω–æ –Ω–∞—Å—Ç—É–ø–Ω–∏–π –º–µ—Ç–æ–¥:
```CSharp
public static async Task DeleteCachedAsync(string key)
{
    var response = await Client!.DeleteAsync($"https://localhost:8081/api/Cache/{key}");
}
```
## –û—á–∏—Å—Ç–∏—Ç–∏ –∫–ª—ñ—î–Ω—Ç–∏ —Ç–∞ –ø–æ—Ç–æ–∫–∏, —â–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∏—Å—è –¥–ª—è –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∏—Ö –º–∞—à–∏–Ω
–î–ª—è –æ—á–∏—â–µ–Ω–Ω—è –∫–ª—ñ—î–Ω—Ç—ñ–≤ —Ç–∞ —Ç–æ–∫—ñ–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å ISSHRequestService –±—É–ª–æ –¥–æ–¥–∞–Ω–æ –Ω–æ–≤–∏–π –º–µ—Ç–æ–¥:
```CSharp
void DisposeClientAndStream(VirtualMachine virtualMachine, string userId);
```

–†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è –º–µ—Ç–æ–¥—É —Å–ø–æ—á–∞—Ç–∫—É –æ—Ç—Ä–∏–º—É—î –∑—ñ —Å–ª–æ–≤–Ω–∏–∫—ñ–≤ –∫–ª—ñ—î–Ω—Ç —Ç–∞ –ø–æ—Ç—ñ–∫, —è–∫—ñ –ø—Ä–∏–≤'—è–∑–∞–Ω—ñ –¥–æ –∞–∫–∞—É–Ω—Ç—É, —è–∫–∏–π –∑–∞—Ä–∞–∑ —É–≤—ñ–π—à–æ–≤ –¥–æ —Å–∏—Å—Ç–µ–º–∏. –î–∞–ª—ñ –º–µ—Ç–æ–¥ –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –∫–ª—ñ—î–Ω—Ç –ø—ñ–¥'—î–¥–Ω–∞–Ω–∏–π, —è–∫—â–æ —Ç–∞–∫, —Ç–æ –≤—ñ–¥'—î–¥–Ω—É—î –π–æ–≥–æ, –ø—ñ—Å–ª—è —á–æ–≥–æ –∑–≤—ñ–ª—å–Ω—è—î –æ–±'—î–∫—Ç–∏ —Ç–∞ –≤–∏–¥–∞–ª—è—î —ó—Ö –∑—ñ —Å–ª–æ–≤–Ω–∏–∫—ñ–≤:
```CSharp
public void DisposeClientAndStream(VirtualMachine virtualMachine, string userId)
{
    var client = GetClient(virtualMachine, userId);
    var stream = GetStream(client, userId, out string? log);

    if (client.IsConnected)
    {
        client.Disconnect();
    }

    stream.Dispose();
    client.Dispose();
    _clients.Remove(userId);
    _streams.Remove(userId);
}
```

–î–ª—è –¥–∞–Ω–æ–≥–æ –º–µ—Ç–æ–¥—É –±—É–≤ —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –æ–∫—Ä–µ–º–∏–π –µ–Ω–¥–ø–æ—ó–Ω—Ç, –¥–ª—è –≤–∏–∫–ª–∏–∫—É –º–µ—Ç–æ–¥—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é http-–∑–∞–ø–∏—Ç—ñ–≤:
```CSharp
[HttpPost("exit")]
[ProducesResponseType(typeof(string), StatusCodes.Status200OK)]
[ProducesResponseType(StatusCodes.Status500InternalServerError)]
public ActionResult DisposeClientAndStream(SSHRequestDto dto)
{
    _service.DisposeClientAndStream(dto.VirtualMachine!, dto.UserId!);

    return Ok();
}
```

–í –∫–ª–∞—Å RequestClient –±—É–ª–æ –¥–æ–¥–∞–Ω–æ –º–µ—Ç–æ–¥, —è–∫–∏–π –≤–∏–∫–æ–Ω—É—î http-–∑–∞–ø–∏—Ç –Ω–∞ —Ü–µ–π –µ–Ω–¥–ø–æ—ó–Ω—Ç:
```CSharp
public static async Task DisposeClientAndStream(SSHRequestDto dto)
{
    var dtoString = JsonConvert.SerializeObject(dto);
    var content = new StringContent(dtoString, Encoding.UTF8, "application/json");
    var response = await Client!.PostAsync($"https://localhost:8081/api/SSHRequest/exit", content);
}
```

–Ü –æ—Å—å —è–∫ —Ü–µ –¥–æ–¥–∞–Ω–æ –≤ –∫–æ–º–∞–Ω–¥—É –≤–∏—Ö–æ–¥—É:
```CSharp
var dto = new SSHRequestDto
{
    VirtualMachine = await RequestClient.GetCachedAsync<VirtualMachine>($"{message!.Chat.Id}_vm"),
    UserId = await (await RequestClient.Client!.GetAsync($"https://localhost:8081/api/Cache/{message.Chat.Id}_current_user_id")).Content.ReadAsStringAsync()
};
.....
await RequestClient.DisposeClientAndStream(dto);
```